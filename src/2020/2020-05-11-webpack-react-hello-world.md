# ä» `hello world` ç¤ºä¾‹è§£æ `webpack` æ‰“åŒ…åçš„ `react` é¡¹ç›®ä»£ç è¿è¡ŒåŸç†

![](http://www.iseeit.cn/wp-content/uploads/2020/05/download.jpeg)

## ç¯å¢ƒ

* webpack 4.43.0
* react 0.14.9
* react-dom 0.14.9
* babel-loader: 8.1.0
* @babel/core: 7.9.0

## å…ˆä¸Šç»“è®º

`webpack` ç¼–è¯‘ç”Ÿæˆçš„ JavaScript æ–‡ä»¶ä»£ç åŸºäºä»¥ä¸‹3ä¸ªæ ¸å¿ƒç‚¹ï¼š

* å…¥å£æ¨¡å—æœ€å¤–å±‚æ˜¯ä¸€ä¸ª `IIFE`ï¼ˆImmediately Invoked Function Expressionï¼‰ï¼Œç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œç¡®ä¿å…¥å£æ¨¡å—ï¼ˆæ–‡ä»¶ï¼‰ä¸€æ—¦åŠ è½½å®Œæ¯•ç«‹åˆ»æ‰§è¡Œåˆå§‹åŒ–ï¼›
* `IIFE` å†…ç½®ä¸€ä¸ªå…¬å…±çš„æ¨¡å—åŠ è½½å‡½æ•°ï¼Œç”¨äºæ¨¡å—åŠ è½½ï¼ˆåŠç¼“å­˜ï¼‰ï¼›
* æ¯ä¸ªæ¨¡å—éƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ï¼ŒåŠ è½½æ¨¡å—æœ¬è´¨å…¶å®æ˜¯æ‰§è¡Œå‡½æ•°ä»£ç å¹¶è¿”å›å…¶æš´éœ²çš„å¯¹è±¡ï¼›

æ‰€ä»¥å…¶æ ¸å¿ƒæ€æƒ³å°±æ˜¯ï¼ŒæŠŠä¸åŒçš„æ¨¡å—ç¼–è¯‘ä¸ºä¸åŒçš„å‡½æ•°ï¼ˆä½¿ç”¨å‡½æ•°ä½œç”¨åŸŸå¯¹ä»£ç è¿›è¡Œç¯å¢ƒéš”ç¦»ï¼‰ï¼Œå¹¶åœ¨éœ€è¦åŠ è½½æ¨¡å—çš„æ—¶å€™æ‰§è¡Œè¯¥æ¨¡å—å¯¹åº”çš„å‡½æ•°ï¼Œoverã€‚

ä¸‹æ–‡åˆ™æ˜¯å¯¹æ ¸å¿ƒä»£ç çš„æŠ½ä¸å‰¥èŒ§ã€‚

## å…¥å£æ¨¡å—ï¼šç«‹å³æ‰§è¡Œå‡½æ•°

åˆ å‡ä¸€äº›éä¸»å¹²åˆ†æ”¯ä»£ç åï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå…¥å£æ¨¡å—ä¸»æ¡†æ¶å¦‚ä¸‹ï¼š

```
 (function(modules) {
  // 1. å£°æ˜æ¨¡å—åŠ è½½å‡½æ•° 
 	function __webpack_require__(moduleId) {
    ... // ç•¥å»è‹¥å¹²éä¸»å¹²ä»£ç 
 		return module.exports;
 	}
  __webpack_require__.* = *;
  ... // ç•¥å»è‹¥å¹²éä¸»å¹²ä»£ç 
  // 2. åŠ è½½å…¥å£æ¨¡å—
  return __webpack_require__(__webpack_require__.s = "./src/index.js");
 })({
   // 3. ä¼ å…¥ä¾èµ–å‚æ•°
   "./src/test.js":(function(module, exports, __webpack_require__){ ... // ç•¥å»è‹¥å¹²éä¸»å¹²ä»£ç  }),
    "react": (function(module, exports) { ... // ç•¥å»è‹¥å¹²éä¸»å¹²ä»£ç  }),
    "react-dom": (function(module, exports) { ... // ç•¥å»è‹¥å¹²éä¸»å¹²ä»£ç  }),
 });
```

ç»§ç»­è¿›è¡Œç²¾ç®€å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç»“æ„ï¼Œå°±æ˜¯ä¸€ä¸ªç«‹å³æ‰§è¡Œå‡½æ•°å˜›ï¼Œå¦‚ä¸‹ï¼š

```
(function(modules) {
  // å‡½æ•°å®ä½“
})({
  // å®å‚
});
```

## ç«‹å³æ‰§è¡Œå‡½æ•°çš„å®å‚ï¼šæ™®é€š JavaScript å¯¹è±¡

ç¤ºä¾‹ä»£ç ä¸­ï¼Œå®å‚å¯¹è±¡æœ‰3ä¸ªå±æ€§ï¼Œå…¶å€¼éƒ½æ˜¯æ™®é€šå‡½æ•°ï¼š

```
{
  "./src/index.js":(function(module, exports, __webpack_require__){ ... // ç•¥å»è‹¥å¹²éä¸»å¹²ä»£ç  }),
  "react": (function(module, exports) { ... // ç•¥å»è‹¥å¹²éä¸»å¹²ä»£ç  }),
  "react-dom": (function(module, exports) { ... // ç•¥å»è‹¥å¹²éä¸»å¹²ä»£ç  }),
}
```

å¯ä»¥çœ‹åˆ°ä¾æ¬¡æ˜¯ï¼š

* é¡¹ç›®å…¥å£æ¨¡å— `./src/index.js` å¯¹åº”çš„å‡½æ•°ï¼›
* `react` æ¨¡å—å¯¹åº”çš„å‡½æ•°ï¼›
* `react-dom` æ¨¡å—å¯¹åº”çš„å‡½æ•°ï¼›

## ç«‹å³æ‰§è¡Œå‡½æ•°å†…éƒ¨é€»è¾‘ï¼šå®šä¹‰æ¨¡å—åŠ è½½å‡½æ•°å¹¶é»˜è®¤åŠ è½½å…¥å£æ¨¡å—

ç«‹å³æ‰§è¡Œå‡½æ•°å†…çš„æ‰§è¡Œè¿‡ç¨‹ä¸»è¦åˆ†ä¸¤æ­¥ï¼š

1. å®šä¹‰æ¨¡å—åŠ è½½å‡½æ•°ï¼›
2. åŠ è½½åˆå§‹æ¨¡å—ï¼›

é¦–å…ˆï¼Œå®šä¹‰æ¨¡å—åŠ è½½å‡½æ•° `__webpack_require__`ï¼š

```
var installedModules = {}; // ç”¨äºç¼“å­˜å·²åŠ è½½æ¨¡å—
function __webpack_require__(moduleId) {
  // æ£€æŸ¥æ¨¡å—æ˜¯å¦å·²ç»è¢«ç¼“å­˜ï¼Œå¦‚å·²ç¼“å­˜ç›´æ¥è¿”å›å…¶ç»“æœå³å¯
  if(installedModules[moduleId]) {
    return installedModules[moduleId].exports;
  }
  // åˆ›å»ºæ¨¡å—ï¼Œå¹¶å°†è¯¥æ¨¡å—æ”¾è¿›ç¼“å­˜
  var module = installedModules[moduleId] = {
    i: moduleId,
    l: false, // æ¨¡å—æ˜¯å¦å·²åŠ è½½å°±ç»ª
    exports: {} // æ¨¡å—å†…å®¹
  };

  // æ‰§è¡Œæ¨¡å—å‡½æ•°ï¼Œå¯¹æ¨¡å—è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™é‡Œçš„ modules æ˜¯æœ€å¤–å±‚ç«‹å³æ‰§è¡Œå‡½æ•°çš„å‚æ•°
  modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);

  // æ ‡è®°è¯¥æ¨¡å—å·²åŠ è½½å°±ç»ª
  module.l = true;

  // è¿”å›å½“å‰æ¨¡å—çš„å®ä½“
  return module.exports;
}
```

å…¶æ¬¡ï¼Œåˆå§‹åŒ–ï¼ŒåŠ è½½å…¥å£æ¨¡å—ï¼š

```
 (function(modules) {
   function __webpack_require__(moduleId){}

   return __webpack_require__('./src/index.js'); // åŠ è½½å…¥å£æ¨¡å—
 })({
   "./src/index.js": (function(){}),
   ...
 })
```

å…¥å£æ¨¡å—ï¼ˆåŒ…å«åˆå§‹ `DOM` çš„åˆ›å»ºä»£ç ï¼‰åŠ è½½ä¹‹åï¼Œé¡µé¢åˆå§‹åŒ–å®Œæˆï¼Œå¦‚ä¸‹ä»£ç ç¤ºä¾‹ï¼š

```
"./src/index.js": (function(){
  "use strict";
  eval(
    ... // ç•¥å»éä¸»å¹²ä»£ç 
    \n\nvar Test = function Test() {\n  return /*#__PURE__*/_react[\"default\"].createElement(\"div\", null, \"hello world\");\n};\n\n_reactDom[\"default\"].render( /*#__PURE__*/_react[\"default\"].createElement(Test, null), document.getElementById(\"app\"));
  );
}),
```

å®è´¨å°±æ˜¯:

1. è°ƒç”¨ `react` çš„ `createElement` æ–¹æ³•åˆ›å»º `DOM`;
2. è°ƒç”¨ `react-dom` çš„ `render` æ–¹æ³•æ¸²æŸ“ä¸Šä¸€æ­¥åˆ›å»ºçš„ `DOM`;


## æ€»ç»“

`webpack`ï¼ˆå€ŸåŠ© `babel`ï¼‰ æ‰“åŒ…åçš„ `react` Web é¡¹ç›®ä»£ç æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š

1. å…¥å£æ¨¡å—æœ€å¤–å±‚æ˜¯ä¸€ä¸ªç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œç¡®ä¿å…¥å£æ¨¡å—ï¼ˆæ–‡ä»¶ï¼‰ä¸€æ—¦åŠ è½½å®Œæ¯•ç«‹åˆ»æ‰§è¡Œåˆå§‹åŒ–ï¼›
2. ç«‹å³æ‰§è¡Œå‡½æ•°å†…ç½®ä¸€ä¸ªå…¬å…±çš„æ¨¡å—åŠ è½½å‡½æ•°ï¼Œç”¨äºæ¨¡å—åŠ è½½ï¼ˆåŠç¼“å­˜ï¼‰ï¼›
3. æ¯ä¸ªæ¨¡å—éƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ï¼ŒåŠ è½½æ¨¡å—æœ¬è´¨å°±æ˜¯æ‰§è¡Œå‡½æ•°ä»£ç å¹¶è¿”å›å…¶æš´éœ²çš„å¯¹è±¡ï¼›

> `webpack`(å€ŸåŠ© `babel`)ç¼–è¯‘çš„æœ¬è´¨å°±æ˜¯æŠŠå„ç§æ¨¡å—ç¼–è¯‘ä¸ºæ™®é€šå‡½æ•°å¹¶æ‰§è¡Œã€‚ï¼ˆğŸ‘ï¼ŒçœŸæ˜¯ç®€å•è€ŒåˆçµåŠ¨å•Šï¼‰

æœ¬æ–‡é¦–å‘äº [ http://www.iseeit.cn/index.php/2020/05/14/webpack-react-babel-hello-world/]( http://www.iseeit.cn/index.php/2020/05/14/webpack-react-babel-hello-world/)ã€‚

ä»¥ä¸Šã€‚
